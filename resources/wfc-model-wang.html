<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <title>
WFC Diagnostics  </title>
  <style>

            body {
                font-family: sans-serif;
                margin: 0;
                padding: 0;
            }

            div.patterns {
                display: flex;
                flex-wrap: wrap;
                gap: 30px;
                width: 100%;
                box-sizing: border-box;
                margin: 0px;
                padding: 10px;
                position: relative;
            }
            
            table.pattern {
                border: 1px solid #666;
                border-radius: 5px;
                margin: 0px;
                padding: 5px;
                background: #fafafa;
                font-size: 15px;
                text-align: center;
                transition: opacity 0.2s;
            }

            table.pattern.highlighted {
                box-shadow: 0 0 10px 3px rgba(0, 0, 0, 0.3);
                transition: box-shadow 0.2s, opacity 0.2s;
            }

            .pattern-info {
                font-size: 12px;
                font-weight: bold;
                text-align: left;
            }

            table.pattern td {
                border: 1px solid #666;
                border-radius: 5px;
                padding: 2px;
                background: #fdfdfd;
            }
            
            svg.connections {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                overflow: visible;
                opacity: 0.35;
            }

            svg.connections line {
                transition: opacity 0.2s;
            }
              </style>
 </head>
 <body>
  <div class="patterns">
   <table class="pattern" id="pattern-0">
    <tr>
     <td class="pattern-info" colspan="1">
ID: 0</br>Frequency: 1</br>Weight: 1.000     </td>
    </tr>
    <tr>
     <td>
0     </td>
    </tr>
   </table>
   <table class="pattern" id="pattern-1">
    <tr>
     <td class="pattern-info" colspan="1">
ID: 1</br>Frequency: 1</br>Weight: 1.000     </td>
    </tr>
    <tr>
     <td>
1     </td>
    </tr>
   </table>
   <table class="pattern" id="pattern-2">
    <tr>
     <td class="pattern-info" colspan="1">
ID: 2</br>Frequency: 1</br>Weight: 1.000     </td>
    </tr>
    <tr>
     <td>
2     </td>
    </tr>
   </table>
   <table class="pattern" id="pattern-3">
    <tr>
     <td class="pattern-info" colspan="1">
ID: 3</br>Frequency: 1</br>Weight: 1.000     </td>
    </tr>
    <tr>
     <td>
3     </td>
    </tr>
   </table>
   <table class="pattern" id="pattern-4">
    <tr>
     <td class="pattern-info" colspan="1">
ID: 4</br>Frequency: 1</br>Weight: 1.000     </td>
    </tr>
    <tr>
     <td>
4     </td>
    </tr>
   </table>
   <table class="pattern" id="pattern-5">
    <tr>
     <td class="pattern-info" colspan="1">
ID: 5</br>Frequency: 1</br>Weight: 1.000     </td>
    </tr>
    <tr>
     <td>
5     </td>
    </tr>
   </table>
   <table class="pattern" id="pattern-6">
    <tr>
     <td class="pattern-info" colspan="1">
ID: 6</br>Frequency: 1</br>Weight: 1.000     </td>
    </tr>
    <tr>
     <td>
6     </td>
    </tr>
   </table>
   <table class="pattern" id="pattern-7">
    <tr>
     <td class="pattern-info" colspan="1">
ID: 7</br>Frequency: 1</br>Weight: 1.000     </td>
    </tr>
    <tr>
     <td>
7     </td>
    </tr>
   </table>
   <table class="pattern" id="pattern-8">
    <tr>
     <td class="pattern-info" colspan="1">
ID: 8</br>Frequency: 1</br>Weight: 1.000     </td>
    </tr>
    <tr>
     <td>
8     </td>
    </tr>
   </table>
  </div>
  <svg class="connections" xmlns="http://www.w3.org/2000/svg">

                <defs>
                    <marker
                        id="arrow-end"
                        markerWidth="4"
                        markerHeight="4"
                        refX="4"
                        refY="2"
                        orient="auto"
                        markerUnits="strokeWidth"
                    >
                        <path d="M0,0 L0,4 L4,2 z" fill="#000" />
                    </marker>
                    <marker
                        id="arrow-start"
                        markerWidth="4"
                        markerHeight="4"
                        refX="-6"
                        refY="2"
                        orient="auto"
                        markerUnits="strokeWidth"
                    >
                        <path d="M0,0 L0,4 L4,2 z" fill="#000" />
                    </marker>
                </defs>
                  </svg>
  <script>

                const edges = [];

                function connect(fromId, toId, fromSide, toSide, color="black") {
                    edges.push({fromId, toId, fromSide, toSide, color});
                }

                function getPortCoordinates(el, side, index = 0, total = 1, portion = 0.8) {
                    const rect = el.getBoundingClientRect();
                    let x, y;

                    if (side === "N") { // top
                        x = rect.left + rect.width / 2;
                        y = rect.top;
                    } else if (side === "S") { // bottom
                        x = rect.left + rect.width / 2;
                        y = rect.bottom;
                    } else if (side === "E") { // right
                        x = rect.right;
                        y = rect.top + rect.height / 2;
                    } else if (side === "W") { // left
                        x = rect.left;
                        y = rect.top + rect.height / 2;
                    } else {
                        x = rect.left + rect.width / 2;
                        y = rect.top + rect.height / 2;
                    }

                    // apply spreading if total > 1
                    if (total > 1) {
                        if (side === "N" || side === "S") {
                            const usableWidth = rect.width * portion;
                            const startX = rect.left + (rect.width - usableWidth) / 2;
                            x = startX + ((index + 0.5) / total) * usableWidth;
                        }
                        if (side === "E" || side === "W") {
                            const usableHeight = rect.height * portion;
                            const startY = rect.top + (rect.height - usableHeight) / 2;
                            y = startY + ((index + 0.5) / total) * usableHeight;
                        }
                    }

                    return { x, y };
                }

                function updateArrows() {
                    const svg = document.querySelector(".connections");
                    svg.innerHTML = svg.querySelector("defs").outerHTML; // preserve arrowhead

                    const pt = svg.createSVGPoint();
                    function toSvgCoords(x, y) {
                        pt.x = x;
                        pt.y = y;
                        return pt.matrixTransform(svg.getScreenCTM().inverse());
                    }

                    const counts = {};
                    edges.forEach(e => {
                        const fromKey = `${e.fromId}_${e.fromSide}`;
                        counts[fromKey] = (counts[fromKey] || 0) + 1;
                        const toKey = `${e.toId}_${e.toSide}`;
                        counts[toKey] = (counts[toKey] || 0) + 1;
                    });

                    const sideUsage = {};

                    edges.forEach(e => {
                        const fromKey = `${e.fromId}_${e.fromSide}`;
                        const fromIndex = sideUsage[fromKey] || 0;
                        const fromTotal = counts[fromKey];

                        const toKey = `${e.toId}_${e.toSide}`;
                        const toIndex = sideUsage[toKey] || 0;
                        const toTotal = counts[toKey];

                        const startCoord = getPortCoordinates(
                            document.getElementById(e.fromId), e.fromSide, fromIndex, fromTotal
                        );
                        const endCoord = getPortCoordinates(
                            document.getElementById(e.toId), e.toSide, toIndex, toTotal
                        );

                        sideUsage[fromKey] = fromIndex + 1;
                        sideUsage[toKey] = toIndex + 1;

                        const start = toSvgCoords(startCoord.x, startCoord.y);
                        const end = toSvgCoords(endCoord.x, endCoord.y);

                        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                        line.setAttribute("x1", start.x);
                        line.setAttribute("y1", start.y);
                        line.setAttribute("x2", end.x);
                        line.setAttribute("y2", end.y);
                        line.setAttribute("stroke", e.color);
                        line.setAttribute("stroke-width", "1.5");
                        line.setAttribute("marker-end", "url(#arrow-end)");
                        line.setAttribute("marker-start", "url(#arrow-start)");

                        // tag for hover filtering
                        line.dataset.from = e.fromId;
                        line.dataset.to = e.toId;
                        line.dataset.fromSide = e.fromSide;
                        line.dataset.toSide = e.toSide;

                        svg.appendChild(line);
                    });

                    document.querySelectorAll(".pattern").forEach(pattern => {
                        pattern.addEventListener("mousemove", event => {
                            const id = pattern.id;
                            const rect = pattern.getBoundingClientRect();
                            const offsetX = event.clientX - rect.left;
                            const offsetY = event.clientY - rect.top;
                            const w = rect.width;
                            const h = rect.height;

                            const margin = 10;
                            let activeSide = null;

                            if (offsetY < margin) activeSide = 'N';
                            else if (offsetY > h - margin) activeSide = 'S';
                            else if (offsetX < margin) activeSide = 'W';
                            else if (offsetX > w - margin) activeSide = 'E';
                            // if cursor is deeper inside the pattern, activeSide stays null → show all sides

                            document.querySelectorAll(".connections line").forEach(line => {
                                if (!activeSide) {
                                    // full pattern hover, show all connected lines
                                    line.style.opacity = (line.dataset.from === id || line.dataset.to === id) ? "1" : "0";
                                } else {
                                    // side-specific hover
                                    const matches = (line.dataset.from === id && line.dataset.fromSide === activeSide)
                                        || (line.dataset.to === id && line.dataset.toSide === activeSide);
                                    line.style.opacity = matches ? "1" : "0";
                                }
                            });

                            // also fade unrelated patterns
                            document.querySelectorAll(".pattern").forEach(p => {
                                p.style.opacity = (p.id === id) ? "1" : "0.5";
                            });
                        });

                        pattern.addEventListener("mouseleave", () => {
                            // restore full visibility
                            document.querySelectorAll(".connections line").forEach(line => {
                                line.style.opacity = "1";
                            });
                            document.querySelectorAll(".pattern").forEach(p => {
                                p.style.opacity = "1";
                            });
                        });
                    });
                }

                function filterPatterns(filterIds) {
                    const allPatterns = document.querySelectorAll(".pattern");
                    const allLines = document.querySelectorAll(".connections line");

                    if (!filterIds || filterIds.length === 0) {
                        // show everything
                        allPatterns.forEach(p => p.style.display = "block");
                        allLines.forEach(l => l.style.display = "block");
                        return;
                    }

                    // first, show only patterns that match the filter or are connected
                    const connectedPatterns = new Set(filterIds);

                    // add any patterns directly connected to filtered patterns
                    allLines.forEach(line => {
                        if (filterIds.includes(line.dataset.from)) connectedPatterns.add(line.dataset.to);
                        if (filterIds.includes(line.dataset.to)) connectedPatterns.add(line.dataset.from);
                    });

                    // show/hide patterns
                    allPatterns.forEach(p => {
                        p.style.display = connectedPatterns.has(p.id) ? "block" : "none";
                    });

                    // show/hide lines (only lines connecting visible patterns)
                    allLines.forEach(line => {
                        if (connectedPatterns.has(line.dataset.from) && connectedPatterns.has(line.dataset.to)) {
                            line.style.display = "block";
                        } else {
                            line.style.display = "none";
                        }
                    });
                }

                window.addEventListener("resize", updateArrows);
                window.addEventListener("scroll", updateArrows);
                connect("pattern-0", "pattern-3", "N", "S", "rgb(255, 0, 0)");
connect("pattern-0", "pattern-5", "N", "S", "rgb(255, 0, 0)");
connect("pattern-0", "pattern-2", "E", "W", "rgb(0, 180, 0)");
connect("pattern-0", "pattern-3", "E", "W", "rgb(0, 180, 0)");
connect("pattern-0", "pattern-4", "E", "W", "rgb(0, 180, 0)");
connect("pattern-0", "pattern-5", "E", "W", "rgb(0, 180, 0)");
connect("pattern-0", "pattern-8", "E", "W", "rgb(0, 180, 0)");
connect("pattern-0", "pattern-1", "S", "N", "rgb(60, 60, 255)");
connect("pattern-0", "pattern-4", "S", "N", "rgb(60, 60, 255)");
connect("pattern-0", "pattern-7", "S", "N", "rgb(60, 60, 255)");
connect("pattern-0", "pattern-1", "W", "E", "rgb(240, 0, 240)");
connect("pattern-0", "pattern-2", "W", "E", "rgb(240, 0, 240)");
connect("pattern-0", "pattern-7", "W", "E", "rgb(240, 0, 240)");
connect("pattern-0", "pattern-8", "W", "E", "rgb(240, 0, 240)");
connect("pattern-1", "pattern-0", "N", "S", "rgb(255, 0, 0)");
connect("pattern-1", "pattern-1", "N", "S", "rgb(255, 0, 0)");
connect("pattern-1", "pattern-2", "N", "S", "rgb(255, 0, 0)");
connect("pattern-1", "pattern-4", "N", "S", "rgb(255, 0, 0)");
connect("pattern-1", "pattern-6", "N", "S", "rgb(255, 0, 0)");
connect("pattern-1", "pattern-7", "N", "S", "rgb(255, 0, 0)");
connect("pattern-1", "pattern-8", "N", "S", "rgb(255, 0, 0)");
connect("pattern-1", "pattern-0", "E", "W", "rgb(0, 180, 0)");
connect("pattern-1", "pattern-1", "E", "W", "rgb(0, 180, 0)");
connect("pattern-1", "pattern-6", "E", "W", "rgb(0, 180, 0)");
connect("pattern-1", "pattern-7", "E", "W", "rgb(0, 180, 0)");
connect("pattern-1", "pattern-1", "S", "N", "rgb(60, 60, 255)");
connect("pattern-1", "pattern-4", "S", "N", "rgb(60, 60, 255)");
connect("pattern-1", "pattern-7", "S", "N", "rgb(60, 60, 255)");
connect("pattern-1", "pattern-1", "W", "E", "rgb(240, 0, 240)");
connect("pattern-1", "pattern-2", "W", "E", "rgb(240, 0, 240)");
connect("pattern-1", "pattern-7", "W", "E", "rgb(240, 0, 240)");
connect("pattern-1", "pattern-8", "W", "E", "rgb(240, 0, 240)");
connect("pattern-2", "pattern-3", "N", "S", "rgb(255, 0, 0)");
connect("pattern-2", "pattern-5", "N", "S", "rgb(255, 0, 0)");
connect("pattern-2", "pattern-0", "E", "W", "rgb(0, 180, 0)");
connect("pattern-2", "pattern-1", "E", "W", "rgb(0, 180, 0)");
connect("pattern-2", "pattern-6", "E", "W", "rgb(0, 180, 0)");
connect("pattern-2", "pattern-7", "E", "W", "rgb(0, 180, 0)");
connect("pattern-2", "pattern-1", "S", "N", "rgb(60, 60, 255)");
connect("pattern-2", "pattern-4", "S", "N", "rgb(60, 60, 255)");
connect("pattern-2", "pattern-7", "S", "N", "rgb(60, 60, 255)");
connect("pattern-2", "pattern-0", "W", "E", "rgb(240, 0, 240)");
connect("pattern-2", "pattern-3", "W", "E", "rgb(240, 0, 240)");
connect("pattern-2", "pattern-4", "W", "E", "rgb(240, 0, 240)");
connect("pattern-2", "pattern-5", "W", "E", "rgb(240, 0, 240)");
connect("pattern-2", "pattern-6", "W", "E", "rgb(240, 0, 240)");
connect("pattern-3", "pattern-3", "N", "S", "rgb(255, 0, 0)");
connect("pattern-3", "pattern-5", "N", "S", "rgb(255, 0, 0)");
connect("pattern-3", "pattern-2", "E", "W", "rgb(0, 180, 0)");
connect("pattern-3", "pattern-3", "E", "W", "rgb(0, 180, 0)");
connect("pattern-3", "pattern-4", "E", "W", "rgb(0, 180, 0)");
connect("pattern-3", "pattern-5", "E", "W", "rgb(0, 180, 0)");
connect("pattern-3", "pattern-8", "E", "W", "rgb(0, 180, 0)");
connect("pattern-3", "pattern-0", "S", "N", "rgb(60, 60, 255)");
connect("pattern-3", "pattern-2", "S", "N", "rgb(60, 60, 255)");
connect("pattern-3", "pattern-3", "S", "N", "rgb(60, 60, 255)");
connect("pattern-3", "pattern-5", "S", "N", "rgb(60, 60, 255)");
connect("pattern-3", "pattern-6", "S", "N", "rgb(60, 60, 255)");
connect("pattern-3", "pattern-8", "S", "N", "rgb(60, 60, 255)");
connect("pattern-3", "pattern-0", "W", "E", "rgb(240, 0, 240)");
connect("pattern-3", "pattern-3", "W", "E", "rgb(240, 0, 240)");
connect("pattern-3", "pattern-4", "W", "E", "rgb(240, 0, 240)");
connect("pattern-3", "pattern-5", "W", "E", "rgb(240, 0, 240)");
connect("pattern-3", "pattern-6", "W", "E", "rgb(240, 0, 240)");
connect("pattern-4", "pattern-0", "N", "S", "rgb(255, 0, 0)");
connect("pattern-4", "pattern-1", "N", "S", "rgb(255, 0, 0)");
connect("pattern-4", "pattern-2", "N", "S", "rgb(255, 0, 0)");
connect("pattern-4", "pattern-4", "N", "S", "rgb(255, 0, 0)");
connect("pattern-4", "pattern-6", "N", "S", "rgb(255, 0, 0)");
connect("pattern-4", "pattern-7", "N", "S", "rgb(255, 0, 0)");
connect("pattern-4", "pattern-8", "N", "S", "rgb(255, 0, 0)");
connect("pattern-4", "pattern-2", "E", "W", "rgb(0, 180, 0)");
connect("pattern-4", "pattern-3", "E", "W", "rgb(0, 180, 0)");
connect("pattern-4", "pattern-4", "E", "W", "rgb(0, 180, 0)");
connect("pattern-4", "pattern-5", "E", "W", "rgb(0, 180, 0)");
connect("pattern-4", "pattern-8", "E", "W", "rgb(0, 180, 0)");
connect("pattern-4", "pattern-1", "S", "N", "rgb(60, 60, 255)");
connect("pattern-4", "pattern-4", "S", "N", "rgb(60, 60, 255)");
connect("pattern-4", "pattern-7", "S", "N", "rgb(60, 60, 255)");
connect("pattern-4", "pattern-0", "W", "E", "rgb(240, 0, 240)");
connect("pattern-4", "pattern-3", "W", "E", "rgb(240, 0, 240)");
connect("pattern-4", "pattern-4", "W", "E", "rgb(240, 0, 240)");
connect("pattern-4", "pattern-5", "W", "E", "rgb(240, 0, 240)");
connect("pattern-4", "pattern-6", "W", "E", "rgb(240, 0, 240)");
connect("pattern-5", "pattern-3", "N", "S", "rgb(255, 0, 0)");
connect("pattern-5", "pattern-5", "N", "S", "rgb(255, 0, 0)");
connect("pattern-5", "pattern-2", "E", "W", "rgb(0, 180, 0)");
connect("pattern-5", "pattern-3", "E", "W", "rgb(0, 180, 0)");
connect("pattern-5", "pattern-4", "E", "W", "rgb(0, 180, 0)");
connect("pattern-5", "pattern-5", "E", "W", "rgb(0, 180, 0)");
connect("pattern-5", "pattern-8", "E", "W", "rgb(0, 180, 0)");
connect("pattern-5", "pattern-0", "S", "N", "rgb(60, 60, 255)");
connect("pattern-5", "pattern-2", "S", "N", "rgb(60, 60, 255)");
connect("pattern-5", "pattern-3", "S", "N", "rgb(60, 60, 255)");
connect("pattern-5", "pattern-5", "S", "N", "rgb(60, 60, 255)");
connect("pattern-5", "pattern-6", "S", "N", "rgb(60, 60, 255)");
connect("pattern-5", "pattern-8", "S", "N", "rgb(60, 60, 255)");
connect("pattern-5", "pattern-0", "W", "E", "rgb(240, 0, 240)");
connect("pattern-5", "pattern-3", "W", "E", "rgb(240, 0, 240)");
connect("pattern-5", "pattern-4", "W", "E", "rgb(240, 0, 240)");
connect("pattern-5", "pattern-5", "W", "E", "rgb(240, 0, 240)");
connect("pattern-5", "pattern-6", "W", "E", "rgb(240, 0, 240)");
connect("pattern-6", "pattern-3", "N", "S", "rgb(255, 0, 0)");
connect("pattern-6", "pattern-5", "N", "S", "rgb(255, 0, 0)");
connect("pattern-6", "pattern-2", "E", "W", "rgb(0, 180, 0)");
connect("pattern-6", "pattern-3", "E", "W", "rgb(0, 180, 0)");
connect("pattern-6", "pattern-4", "E", "W", "rgb(0, 180, 0)");
connect("pattern-6", "pattern-5", "E", "W", "rgb(0, 180, 0)");
connect("pattern-6", "pattern-8", "E", "W", "rgb(0, 180, 0)");
connect("pattern-6", "pattern-1", "S", "N", "rgb(60, 60, 255)");
connect("pattern-6", "pattern-4", "S", "N", "rgb(60, 60, 255)");
connect("pattern-6", "pattern-7", "S", "N", "rgb(60, 60, 255)");
connect("pattern-6", "pattern-1", "W", "E", "rgb(240, 0, 240)");
connect("pattern-6", "pattern-2", "W", "E", "rgb(240, 0, 240)");
connect("pattern-6", "pattern-7", "W", "E", "rgb(240, 0, 240)");
connect("pattern-6", "pattern-8", "W", "E", "rgb(240, 0, 240)");
connect("pattern-7", "pattern-0", "N", "S", "rgb(255, 0, 0)");
connect("pattern-7", "pattern-1", "N", "S", "rgb(255, 0, 0)");
connect("pattern-7", "pattern-2", "N", "S", "rgb(255, 0, 0)");
connect("pattern-7", "pattern-4", "N", "S", "rgb(255, 0, 0)");
connect("pattern-7", "pattern-6", "N", "S", "rgb(255, 0, 0)");
connect("pattern-7", "pattern-7", "N", "S", "rgb(255, 0, 0)");
connect("pattern-7", "pattern-8", "N", "S", "rgb(255, 0, 0)");
connect("pattern-7", "pattern-0", "E", "W", "rgb(0, 180, 0)");
connect("pattern-7", "pattern-1", "E", "W", "rgb(0, 180, 0)");
connect("pattern-7", "pattern-6", "E", "W", "rgb(0, 180, 0)");
connect("pattern-7", "pattern-7", "E", "W", "rgb(0, 180, 0)");
connect("pattern-7", "pattern-1", "S", "N", "rgb(60, 60, 255)");
connect("pattern-7", "pattern-4", "S", "N", "rgb(60, 60, 255)");
connect("pattern-7", "pattern-7", "S", "N", "rgb(60, 60, 255)");
connect("pattern-7", "pattern-1", "W", "E", "rgb(240, 0, 240)");
connect("pattern-7", "pattern-2", "W", "E", "rgb(240, 0, 240)");
connect("pattern-7", "pattern-7", "W", "E", "rgb(240, 0, 240)");
connect("pattern-7", "pattern-8", "W", "E", "rgb(240, 0, 240)");
connect("pattern-8", "pattern-3", "N", "S", "rgb(255, 0, 0)");
connect("pattern-8", "pattern-5", "N", "S", "rgb(255, 0, 0)");
connect("pattern-8", "pattern-0", "E", "W", "rgb(0, 180, 0)");
connect("pattern-8", "pattern-1", "E", "W", "rgb(0, 180, 0)");
connect("pattern-8", "pattern-6", "E", "W", "rgb(0, 180, 0)");
connect("pattern-8", "pattern-7", "E", "W", "rgb(0, 180, 0)");
connect("pattern-8", "pattern-1", "S", "N", "rgb(60, 60, 255)");
connect("pattern-8", "pattern-4", "S", "N", "rgb(60, 60, 255)");
connect("pattern-8", "pattern-7", "S", "N", "rgb(60, 60, 255)");
connect("pattern-8", "pattern-0", "W", "E", "rgb(240, 0, 240)");
connect("pattern-8", "pattern-3", "W", "E", "rgb(240, 0, 240)");
connect("pattern-8", "pattern-4", "W", "E", "rgb(240, 0, 240)");
connect("pattern-8", "pattern-5", "W", "E", "rgb(240, 0, 240)");
connect("pattern-8", "pattern-6", "W", "E", "rgb(240, 0, 240)");
updateArrows();
  </script>
 </body>
</html>
